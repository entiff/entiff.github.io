---
layout: post
title:  "A/B 테스트와 실험설계(Experimental Design)"
date:   2018-11-25 21:00:00
author: 김태희
categories: Statistics
---

오늘은 A/B 테스트 즉, **실험 설계(Experimental Design)** 에 대한 이야기를 해볼까 합니다. 실험은 인과관계를 증명할 수 있는 유일한 방법입니다. 그러나 설계가 매우 까다롭습니다. 복잡한 행동을 측정하기 어렵고, 수많은 오염변인과 통제변인을 고려하기가 어렵습니다. 그럼에도 많은 분야에서 과학적 분석방법으로 널리 사용되고 있습니다. 이번 글은 David W. Martin의 'Doing Psychology Experiments(심리학 실험법)'를 참고했습니다.

A/B 테스트는 대표적인 통계적 가설 검정 유형 중 하나입니다.

![A/Btest](https://upload.wikimedia.org/wikipedia/commons/thumb/2/2e/A-B_testing_example.png/465px-A-B_testing_example.png)

위의 그림을 참고해 실험을 설계해 보겠습니다. 요약하자면 다음과 같습니다. 왼쪽은 A안, 오른쪽이 B안입니다. 무선으로 할당된 100명이 각각 A안과 B안에 배정됩니다. 일정시간 이후 관심있는 변수인 클릭률을 비교하고 A안과 B안 중에서 하나를 선택합니다.

### 독립변인, 종속변인, 오염변인, 통제변인

예시를 조금 더 자세히 살펴보겠습니다. 독립변인(Independent Variable)은 클릭 버튼의 유형이 됩니다. 2가지의 값을 갖는 범주형 변수(Categorical Variable)입니다. 종속변인(Dependent Variable)은 클릭률이고 연속형 변수(Continuous Variable)입니다. 주로 분석가나 연구자가 관심있는 평균값(Mean)입니다. 이를 t-test, ANOVA 등으로 가설검정합니다. 제대로 된 실험을 위해서는 독립변인의 상황을 무선할당(Random Assignment)해야 합니다. 이 경우에는 참가자를 동일한 확률로 A안과 B안에 할당하는 것을 말합니다. 분석가가 참가자를 임의로 A안과 B안에 할당할 경우 참가자 선택이 체계적으로 변하기 때문에 오염변인(Confounding Variable)이 간섭하게 됩니다. 이렇듯 무선적으로 변화하는 변인을 무선변인(Random Variable)이라고 합니다. 반면 상황을 통제해야 하는 변인도 있습니다. 대표적으로 시간은 통제변인(Control Variable)입니다. 동시에 노출되어야 하고, 같은 시간 동안 노출시킨 뒤 클릭률을 측정해야 합니다. 예를 들어 11시에 노출되고 1시간 뒤 A안과 B안의 클릭률을 측정해야 합니다.

### 실험의 기본 3요소

그러나, 다양한 이유로 실험(Experiment)은 어렵습니다. 다시 말해, 정말 독립변인의 변화가 종속변인의 변화를 일으켰는지 알기 어렵습니다. 이를 실험의 내적타당도(Internal Validity)를 위협한다고 말합니다. 인과관계를 증명하는 길은 멀고도 험합니다. 실험을 위해 고려해야 하는 3가지 대표적인 요소를 알아보도록 하겠습니다.

먼저 가장 중요한 **'무선할당'** 입니다. 무선할당은 모든 실험에 해당합니다. 이 조건을 만족하지 못하면 인과관계를 증명할 수 없습니다. 무선할당은 참가자들을 독립변인의 수준에 동일한 확률로 배정하는 것입니다. 위 예시의 경우 200명이 A안과 B안에 각각 배정될 확률이 동일하게 50%여야 합니다. 독립변인의 수준이 늘어날 경우 역시 동일합니다. A,B,C안이 있다고 가정할 때, 참가자가 각각에 배정될 확률은 33.3%여야 합니다.

다음으로 가장 까다로운 **'시간'** 입니다. A안 참가자들은 25일 11시, B안 참가자들은 26일 11시에 노출됐다고 해봅시다. 하루동안의 웹서핑 경험이 B안 참가자들에게 영향을 끼쳐 25일 11시에 노출됐을 때와는 다른 클릭률을 얻게 됩니다. 참가자들의 시간적, 경험적 성숙이 오염변인으로 작용하는 것입니다. 따라서, 편의대로 다른 시간에 실험을 진행해서는 안됩니다. '시간'이라는 변인이 실험에 어떤 영향을 끼치는지 반드시 고려해보고 통제할지 말아야할지 결정해야 합니다.

마지막으로는 **'사전검사'** 입니다. 전형적인 A/B 테스트는 사실 실험이 아닙니다. 사전검사가 빠져있기 때문입니다. 다시 말해, 참가자를 무선할당 한 뒤에 A안과 B안에 노출시키기 이전에 클릭률을 측정해야 합니다. 이유는 간단합니다. A안과 B안의 참가자들이 동등한 집단인지 확인해야 하기 때문입니다. 사전검사가 빠져 있을 경우, 클릭률의 차이가 원래 집단간 차이 때문에 일어난 것인지, 클릭 버튼이 바뀌었기 때문인지 알 수 없습니다.

정리하자면 실험 설계를 위해서는 독립변인, 종속변인, 통제변인, 무선변인에 대한 충분한 탐구가 필요합니다. 독립변인과 종속변인에 영향을 끼칠 수 있는 변인이 무엇인지 파악합니다. 그리고 어떤 변인을 어떻게 통제하고, 무선적으로 변하게 할 것인지 판단합니다. 실험마다 수많은 오염변인이 개입하기 때문에 완전한 실험을 진행하는 것은 매우 어렵습니다. 앞의 요소를 모두 고려해도 완전한 실험이라고 부르기 어렵습니다. 그렇기 때문에 분석가들은 현실적으로 비실험적 설계(Non-experimental design) 또는 준실험설계(Quasi-experimental design)를 선택합니다.

준실험설계는 무선할당 조건을 위반합니다. 다시 말해, A안과 B안에 참가하는 집단에 서로 차이가 있습니다. 그러나, 이 경우에도 사전검사를 반드시 실시해야 합니다. 그래야 집단간 차이를 고려해 클릭 버튼이 클릭률에 어떤 영향을 미쳤는지 파악할 수 있기 때문입니다. 사전검사, 시간, 통계적 회귀, 사망률 등 내적타당도에 영향을 미치는 대부분의 요소를 파악할 수 있는 실험설계를 준실험설계라 합니다.

비실험설계에서는 내적타당도에 영향을 주는 요소의 대부분을 파악할 수 없습니다. 사실, 대표적인 A/B 테스트 사례들은 대부분 준실험설계와 비실험설계에 속합니다. 오염변인을 제대로 통제하지 못했기 때문입니다. 참가자를 무선할당 했더라도 사전검사가 없는 경우가 대부분입니다. 일단 집단간 차이가 종속변인에 미치는 영향을 고려할 수 없습니다. 무선할당과 함께 실험 참가자의 수를 충분히 늘렸을 경우 집단간 차이를 줄일 수 있지만 가장 좋은 방법은 사전검사를 실시하는 실험설계입니다.

오늘은 실험설계, 준실험설계, 비실험설계에 대해 간단히 알아보았습니다. A/B 테스트는 다양한 분야에서 효과적인 방법으로 널리 알려져 있지만 실험설계가 아닌 경우 인과관계를 증명할 수 없습니다. 따라서, 분석가는 자신이 설계한 실험이 실험설계, 준실험설계, 비실험설계 중 어떤 실험에 해당하는 것인지 정확하게 판단하고 보고하는 것이 중요합니다.
